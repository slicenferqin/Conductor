# PRD: é¡¹ç›®åˆ›å»ºæµç¨‹ä¼˜åŒ–

## èƒŒæ™¯

å½“å‰åˆ›å»ºé¡¹ç›®åï¼Œç”¨æˆ·è¿›å…¥ç©ºç™½çš„ç¾¤èŠç•Œé¢ï¼Œæ²¡æœ‰ä»»ä½•å³æ—¶åé¦ˆï¼Œä½“éªŒæ–­å±‚ã€‚éœ€è¦ä¼˜åŒ–ä¸ºæœ‰äº¤äº’æ„Ÿçš„æµç¨‹ã€‚

## ç›®æ ‡

ç”¨æˆ·åˆ›å»ºé¡¹ç›®åï¼Œèƒ½å¤Ÿç«‹å³çœ‹åˆ°ç¾¤èŠäº’åŠ¨ï¼Œæ„Ÿå—åˆ°"ç§˜ä¹¦åœ¨å¤„ç†éœ€æ±‚"çš„è¿‡ç¨‹ã€‚

## æµç¨‹è®¾è®¡

### æ—¶é—´çº¿

```
[ç”¨æˆ·ç‚¹å‡»åˆ›å»ºé¡¹ç›®]
        â”‚
        â–¼ é˜¶æ®µ1: å³æ—¶åé¦ˆï¼ˆ< 100msï¼ŒåŒæ­¥è¿”å›ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘¤ ç”¨æˆ·: "{ç”¨æˆ·è¾“å…¥çš„éœ€æ±‚}"                    â”‚
â”‚ ğŸ“¢ ç³»ç»Ÿ: ğŸ¤–ç§˜ä¹¦ åŠ å…¥äº†ç¾¤èŠ                     â”‚
â”‚ ğŸ¤– ç§˜ä¹¦: "å¥½çš„ï¼Œæˆ‘æ¥åˆ†æéœ€æ±‚å¹¶ç»„å»ºå›¢é˜Ÿ..."      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ é˜¶æ®µ2: éœ€æ±‚åˆ†æï¼ˆå¼‚æ­¥ï¼Œ5-15ç§’ï¼‰
        â”‚   åå°: ç§˜ä¹¦è°ƒç”¨ Claude åˆ†æéœ€æ±‚
        â”‚
        â–¼ åˆ†æå®Œæˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– ç§˜ä¹¦: "éœ€æ±‚åˆ†æå®Œæˆï¼                       â”‚
â”‚                                              â”‚
â”‚ ğŸ“‹ ä»»åŠ¡æ‹†è§£ï¼š                                 â”‚
â”‚ 1. [è°ƒç ”å‘˜] {å…·ä½“ä»»åŠ¡}                        â”‚
â”‚ 2. [åˆ†æå¸ˆ] {å…·ä½“ä»»åŠ¡}                        â”‚
â”‚ 3. [å‰ç«¯å¼€å‘] {å…·ä½“ä»»åŠ¡}                      â”‚
â”‚ ..."                                         â”‚
â”‚                                              â”‚
â”‚ [ç¾¤å…¬å‘Šæ›´æ–°] â† ç½®é¡¶æ˜¾ç¤ºéœ€æ±‚æ‹†è§£                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ é˜¶æ®µ3: å›¢é˜Ÿç»„å»ºï¼ˆä¸€æ¬¡æ€§æ˜¾ç¤ºï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¢ ç³»ç»Ÿ: å›¢é˜Ÿæˆå‘˜å·²å°±ä½                        â”‚
â”‚   ğŸ” è°ƒç ”å‘˜                                   â”‚
â”‚   ğŸ“Š åˆ†æå¸ˆ                                   â”‚
â”‚   ğŸ¨ å‰ç«¯å¼€å‘                                 â”‚
â”‚   âœ… éªŒæ”¶å‘˜                                   â”‚
â”‚                                              â”‚
â”‚ [å³ä¾§å›¢é˜Ÿé¢æ¿åŒæ­¥æ›´æ–°]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ é˜¶æ®µ4: ä»»åŠ¡åˆ†é…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– ç§˜ä¹¦: "å›¢é˜Ÿå·²ç»„å»ºå®Œæˆï¼ä»»åŠ¡åˆ†é…å¦‚ä¸‹ï¼š        â”‚
â”‚                                              â”‚
â”‚ @è°ƒç ”å‘˜ è¯·å…ˆè¿›è¡Œ{ä»»åŠ¡æè¿°}                     â”‚
â”‚ @åˆ†æå¸ˆ è¯·ç­‰å¾…è°ƒç ”å®Œæˆåè¿›è¡Œ{ä»»åŠ¡æè¿°}          â”‚
â”‚ @å‰ç«¯å¼€å‘ è¯·ç­‰å¾…å†…å®¹å°±ç»ªåè¿›è¡Œ{ä»»åŠ¡æè¿°}        â”‚
â”‚ @éªŒæ”¶å‘˜ æœ€åè¿›è¡Œäº§å‡ºç‰©éªŒæ”¶                     â”‚
â”‚                                              â”‚
â”‚ å¼€å§‹æ‰§è¡Œï¼"                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ çŠ¶æ€å˜åŒ–: PLANNING â†’ RUNNING
        â”‚
        â–¼ é˜¶æ®µ5: Agent å¼€å§‹å·¥ä½œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” è°ƒç ”å‘˜: "æ”¶åˆ°ï¼Œå¼€å§‹æ‰§è¡Œä»»åŠ¡..."              â”‚
â”‚ ğŸ” è°ƒç ”å‘˜ ğŸ’­: ğŸ” æœç´¢ç½‘ç»œ: {å…³é”®è¯}            â”‚
â”‚ ...                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŠ€æœ¯æ–¹æ¡ˆ

### åç«¯ä¿®æ”¹

#### 1. `orchestrator_bridge.start_project()`

**èŒè´£**ï¼šåˆ›å»ºé¡¹ç›®å¹¶å‘é€åˆå§‹æ¶ˆæ¯ï¼ˆåŒæ­¥ï¼‰

```python
async def start_project(self, requirement: str) -> ProjectResponse:
    # 1. åˆ›å»º placeholder é¡¹ç›®
    project_id = str(uuid.uuid4())[:8]
    project = ProjectResponse(...)

    # 2. ç«‹å³å‘é€åˆå§‹æ¶ˆæ¯ï¼ˆé˜¶æ®µ1ï¼‰
    await self._send_initial_messages(project_id, requirement)

    # 3. å¯åŠ¨åå°ä»»åŠ¡å¤„ç†åç»­æµç¨‹
    task = asyncio.create_task(
        self._process_project(project_id, requirement)
    )

    # 4. ç«‹å³è¿”å›é¡¹ç›®
    return project
```

#### 2. `_send_initial_messages()` (æ–°å¢)

**èŒè´£**ï¼šå‘é€é˜¶æ®µ1çš„å³æ—¶æ¶ˆæ¯

```python
async def _send_initial_messages(self, project_id: str, requirement: str):
    # æ¶ˆæ¯1: ç”¨æˆ·éœ€æ±‚
    await self._broadcast_message(project_id, {
        "fromId": "user",
        "fromName": "ğŸ‘¤ ç”¨æˆ·",
        "content": requirement,
        "type": "user"
    })

    # æ¶ˆæ¯2: ç§˜ä¹¦åŠ å…¥
    await self._broadcast_message(project_id, {
        "fromId": "system",
        "fromName": "ç³»ç»Ÿ",
        "content": "ğŸ¤– ç§˜ä¹¦ åŠ å…¥äº†ç¾¤èŠ",
        "type": "system"
    })

    # æ¶ˆæ¯3: ç§˜ä¹¦å“åº”
    await self._broadcast_message(project_id, {
        "fromId": "secretary",
        "fromName": "ğŸ¤– ç§˜ä¹¦",
        "content": "å¥½çš„ï¼Œæˆ‘æ¥åˆ†æéœ€æ±‚å¹¶ç»„å»ºå›¢é˜Ÿ...",
        "type": "agent"
    })
```

#### 3. `_process_project()` (é‡æ„)

**èŒè´£**ï¼šå¼‚æ­¥å¤„ç†åç»­æµç¨‹ï¼ˆé˜¶æ®µ2-5ï¼‰

```python
async def _process_project(self, project_id: str, requirement: str):
    try:
        # é˜¶æ®µ2: è°ƒç”¨ secretary åˆ†æéœ€æ±‚
        project, team_config = await self.secretary.analyze_requirement(requirement)

        # å‘é€éœ€æ±‚æ‹†è§£æ¶ˆæ¯
        await self._send_analysis_result(project_id, team_config)

        # æ›´æ–°ç¾¤å…¬å‘Šï¼ˆrequirementsï¼‰
        await self._update_requirements(project_id, team_config)

        # é˜¶æ®µ3: å‘é€å›¢é˜Ÿç»„å»ºæ¶ˆæ¯ + æ›´æ–°å›¢é˜Ÿé¢æ¿
        await self._send_team_formed(project_id, project.team)

        # é˜¶æ®µ4: å‘é€ä»»åŠ¡åˆ†é…æ¶ˆæ¯
        await self._send_task_assignment(project_id, team_config)

        # çŠ¶æ€ â†’ RUNNING
        await self._emit_project_status(project_id, "RUNNING")

        # é˜¶æ®µ5: å¼€å§‹æ‰§è¡Œä»»åŠ¡
        await self._run_orchestrator(...)

    except Exception as e:
        await self._emit_project_status(project_id, "FAILED", error=str(e))
```

### å‰ç«¯ä¿®æ”¹

#### 1. æ¶ˆæ¯ç±»å‹å¤„ç†

ç¡®ä¿ WebSocket èƒ½æ­£ç¡®å¤„ç†ä»¥ä¸‹æ¶ˆæ¯ç±»å‹ï¼š
- `user`: ç”¨æˆ·æ¶ˆæ¯
- `system`: ç³»ç»Ÿæ¶ˆæ¯ï¼ˆå…¥ç¾¤é€šçŸ¥ç­‰ï¼‰
- `agent`: Agent æ¶ˆæ¯
- `progress`: è¿›åº¦æ¶ˆæ¯

#### 2. å›¢é˜Ÿé¢æ¿åŒæ­¥

æ”¶åˆ° `team_formed` äº‹ä»¶æ—¶ï¼Œæ›´æ–°å³ä¾§å›¢é˜Ÿé¢æ¿ã€‚

### æ¶ˆæ¯æ ¼å¼

#### æ–°å¢ç³»ç»Ÿæ¶ˆæ¯ç±»å‹

```typescript
// å…¥ç¾¤é€šçŸ¥
{
  type: "system",
  content: "ğŸ¤– ç§˜ä¹¦ åŠ å…¥äº†ç¾¤èŠ"
}

// å›¢é˜Ÿç»„å»ºé€šçŸ¥
{
  type: "system",
  content: "å›¢é˜Ÿæˆå‘˜å·²å°±ä½ï¼š\nğŸ” è°ƒç ”å‘˜\nğŸ“Š åˆ†æå¸ˆ\nğŸ¨ å‰ç«¯å¼€å‘\nâœ… éªŒæ”¶å‘˜"
}
```

## éªŒæ”¶æ ‡å‡†

1. [ ] åˆ›å»ºé¡¹ç›®å < 100ms å†…æ˜¾ç¤ºåˆå§‹æ¶ˆæ¯
2. [ ] ç”¨æˆ·éœ€æ±‚æ¶ˆæ¯æ­£ç¡®æ˜¾ç¤º
3. [ ] ç§˜ä¹¦å…¥ç¾¤é€šçŸ¥æ˜¾ç¤º
4. [ ] ç§˜ä¹¦å³æ—¶å“åº”æ¶ˆæ¯æ˜¾ç¤º
5. [ ] éœ€æ±‚åˆ†æå®Œæˆåæ˜¾ç¤ºæ‹†è§£ç»“æœ
6. [ ] ç¾¤å…¬å‘Šæ­£ç¡®æ›´æ–°
7. [ ] å›¢é˜Ÿç»„å»ºæ¶ˆæ¯æ˜¾ç¤º
8. [ ] å³ä¾§å›¢é˜Ÿé¢æ¿åŒæ­¥æ›´æ–°
9. [ ] ä»»åŠ¡åˆ†é…æ¶ˆæ¯æ˜¾ç¤ºï¼ŒåŒ…å«æ­£ç¡®çš„ @mention
10. [ ] çŠ¶æ€ä» PLANNING å˜ä¸º RUNNING
11. [ ] Agent å¼€å§‹æ‰§è¡Œä»»åŠ¡

## è¾¹ç•Œæƒ…å†µ

1. **åˆ†æå¤±è´¥**ï¼šç§˜ä¹¦å‘é€é”™è¯¯æ¶ˆæ¯ï¼ŒçŠ¶æ€å˜ä¸º FAILED
2. **ç½‘ç»œæ–­å¼€**ï¼šWebSocket é‡è¿åï¼Œé€šè¿‡ API è·å–å†å²æ¶ˆæ¯
3. **é¡µé¢åˆ·æ–°**ï¼šé‡æ–°åŠ è½½æ¶ˆæ¯ï¼Œæ˜¾ç¤ºå½“å‰çŠ¶æ€

## ä¸åœ¨æœ¬æ¬¡èŒƒå›´

1. å›¢é˜Ÿæˆå‘˜é€ä¸ªå…¥ç¾¤åŠ¨ç”»ï¼ˆåç»­å¯ä¼˜åŒ–ï¼‰
2. ä»»åŠ¡åˆ†é…é€æ¡å‘é€ï¼ˆåç»­å¯ä¼˜åŒ–ï¼‰
3. åˆ†æè¿›åº¦å®æ—¶æ˜¾ç¤ºï¼ˆåç»­å¯ä¼˜åŒ–ï¼‰
